{"version":3,"sources":["../../src/sanitizer/htmlsanitizer.js"],"names":["toLowerCase","defs","TagPolicyDecision","TagPolicy","html","html4","ENTITIES","decimalEscapeRe","hexEscapeRe","safeEntityNameRe","entityLookupElement","window","createElement","lookupEntity","name","hasOwnProperty","m","match","String","fromCharCode","parseInt","test","innerHTML","text","textContent","decodeOneEntity","_","nulRe","stripNULs","s","replace","ENTITY_RE_1","ENTITY_RE_2","unescapeEntities","ampRe","looseAmpRe","ltRe","gtRe","quotRe","escapeAttrib","normalizeRCData","rcdata","ATTR_RE","RegExp","splitWillCapture","split","length","EFLAGS_TEXT","eflags","makeSaxParser","handler","hcopy","cdata","comment","endDoc","endTag","pcdata","startDoc","startTag","htmlText","param","parse","continuationMarker","p","tagName","parts","htmlSplit","state","noMoreGT","noMoreEndComments","parseCPS","continuationMaker","h","initial","pos","end","current","next","exec","parseEndTag","ELEMENTS","tag","parseText","parseStartTag","slice","join","substr","e","str","re","lastPos","push","substring","index","parseTagAndAttrs","attrs","endTagRe","first","buf","Error","quote","sawQuote","abuf","indexOf","aName","aValue","decodeValue","v","q","charCodeAt","makeHtmlSanitizer","tagPolicy","stack","ignoring","emit","out","tagNameOrig","attribs","eflagsOrig","decision","eflagsRep","tagNameRep","onStack","orig","rep","i","n","attribName","value","stackElOrigTag","stackElRepTag","ALLOWED_URI_SCHEMES","safeUri","uri","effect","ltype","hints","naiveUriRewriter","parsed","hasScheme","getScheme","safe","toString","log","logger","oldValue","newValue","change","changed","lookupAttribute","map","attribKey","getAttributeType","ATTRIBS","getLoaderType","LOADERTYPES","getUriEffect","URIEFFECTS","sanitizeAttribs","opt_naiveUriRewriter","opt_nmTokenPolicy","opt_logger","atype","sanitizedDeclarations","property","tokens","normProp","url","ueffects","SAME_DOCUMENT","ltypes","SANDBOXED","charAt","makeTagPolicy","undefined","sanitizeWithPolicy","inputHtml","outputArray","sanitize","html_sanitize"],"mappings":"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","file":"htmlsanitizer.js","sourcesContent":["/* eslint-disable */\n\n//\n// FROM: https://caja.appspot.com/v6012-es53-2-ge0690ee2/ses-single-frame.js\n//\n\n// Copyright (C) 2006 Google Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview\n * An HTML sanitizer that can satisfy a variety of security policies.\n *\n * <p>\n * The HTML sanitizer is built around a SAX parser and HTML element and\n * attributes schemas.\n *\n * If the cssparser is loaded, inline styles are sanitized using the\n * css property and value schemas.  Else they are remove during\n * sanitization.\n *\n * If it exists, uses parseCssDeclarations, sanitizeCssProperty,  cssSchema\n *\n * @author mikesamuel@gmail.com\n * @author jasvir@gmail.com\n * \\@requires html4, URI\n * \\@overrides window\n * \\@provides html, html_sanitize, defs\n */\n\nimport URI from './uri';\nimport html4 from './html4';\nimport { parseCssDeclarations } from './cssparser';\nimport { sanitizeCssProperty } from './sanitizecss';\nimport cssSchema from './csspropbit';\n\n// The Turkish i seems to be a non-issue, but abort in case it is.\nif ('I'.toLowerCase() !== 'i') { throw 'I/i problem'; }\n\n// TODO(kpreid): Refactor so there is no global introduced by these type\n// definitions.\n\n/**\n * Contains types related to sanitizer policies.\n * \\@namespace\n */\nvar defs = {};\n\n/**\n * A decision about what to do with a tag.\n * @typedef {{ 'attribs': ?Array.<string>, 'tagName': ?string }}\n */\ndefs.TagPolicyDecision;\n\n/**\n * A function that takes a tag name (canonical) and an array of attributes\n * and decides what to do, returning null to indicate the tag should be dropped\n * entirely from the output.\n *\n * @typedef {function(string, Array.<string>): ?defs.TagPolicyDecision}\n */\ndefs.TagPolicy;\n\n\n/**\n * \\@namespace\n */\nvar html = (function(html4) {\n\n  // The keys of this object must be 'quoted' or JSCompiler will mangle them!\n  // This is a partial list -- lookupEntity() uses the host browser's parser\n  // (when available) to implement full entity lookup.\n  // Note that entities are in general case-sensitive; the uppercase ones are\n  // explicitly defined by HTML5 (presumably as compatibility).\n  var ENTITIES = {\n    'lt': '<',\n    'LT': '<',\n    'gt': '>',\n    'GT': '>',\n    'amp': '&',\n    'AMP': '&',\n    'quot': '\"',\n    'apos': '\\'',\n    'nbsp': '\\u00A0'\n  };\n\n  // Patterns for types of entity/character reference names.\n  var decimalEscapeRe = /^#(\\d+)$/;\n  var hexEscapeRe = /^#x([0-9A-Fa-f]+)$/;\n  // contains every entity per http://www.w3.org/TR/2011/WD-html5-20110113/named-character-references.html\n  var safeEntityNameRe = /^[A-Za-z][A-Za-z0-9]+$/;\n  // Used as a hook to invoke the browser's entity parsing. <textarea> is used\n  // because its content is parsed for entities but not tags.\n  // TODO(kpreid): This retrieval is a kludge and leads to silent loss of\n  // functionality if the document isn't available.\n  var entityLookupElement =\n      ('undefined' !== typeof window && window['document'])\n          ? window['document'].createElement('textarea') : null;\n  /**\n   * Decodes an HTML entity.\n   *\n   * {\\@updoc\n   * $ lookupEntity('lt')\n   * # '<'\n   * $ lookupEntity('GT')\n   * # '>'\n   * $ lookupEntity('amp')\n   * # '&'\n   * $ lookupEntity('nbsp')\n   * # '\\xA0'\n   * $ lookupEntity('apos')\n   * # \"'\"\n   * $ lookupEntity('quot')\n   * # '\"'\n   * $ lookupEntity('#xa')\n   * # '\\n'\n   * $ lookupEntity('#10')\n   * # '\\n'\n   * $ lookupEntity('#x0a')\n   * # '\\n'\n   * $ lookupEntity('#010')\n   * # '\\n'\n   * $ lookupEntity('#x00A')\n   * # '\\n'\n   * $ lookupEntity('Pi')      // Known failure\n   * # '\\u03A0'\n   * $ lookupEntity('pi')      // Known failure\n   * # '\\u03C0'\n   * }\n   *\n   * @param {string} name the content between the '&' and the ';'.\n   * @return {string} a single unicode code-point as a string.\n   */\n  function lookupEntity(name) {\n    // TODO: entity lookup as specified by HTML5 actually depends on the\n    // presence of the \";\".\n    if (ENTITIES.hasOwnProperty(name)) { return ENTITIES[name]; }\n    var m = name.match(decimalEscapeRe);\n    if (m) {\n      return String.fromCharCode(parseInt(m[1], 10));\n    } else if (!!(m = name.match(hexEscapeRe))) {\n      return String.fromCharCode(parseInt(m[1], 16));\n    } else if (entityLookupElement && safeEntityNameRe.test(name)) {\n      entityLookupElement.innerHTML = '&' + name + ';';\n      var text = entityLookupElement.textContent;\n      ENTITIES[name] = text;\n      return text;\n    } else {\n      return '&' + name + ';';\n    }\n  }\n\n  function decodeOneEntity(_, name) {\n    return lookupEntity(name);\n  }\n\n  var nulRe = /\\0/g;\n  function stripNULs(s) {\n    return s.replace(nulRe, '');\n  }\n\n  var ENTITY_RE_1 = /&(#[0-9]+|#[xX][0-9A-Fa-f]+|\\w+);/g;\n  var ENTITY_RE_2 = /^(#[0-9]+|#[xX][0-9A-Fa-f]+|\\w+);/;\n  /**\n   * The plain text of a chunk of HTML CDATA which possibly containing.\n   *\n   * {\\@updoc\n   * $ unescapeEntities('')\n   * # ''\n   * $ unescapeEntities('hello World!')\n   * # 'hello World!'\n   * $ unescapeEntities('1 &lt; 2 &amp;&AMP; 4 &gt; 3&#10;')\n   * # '1 < 2 && 4 > 3\\n'\n   * $ unescapeEntities('&lt;&lt <- unfinished entity&gt;')\n   * # '<&lt <- unfinished entity>'\n   * $ unescapeEntities('/foo?bar=baz&copy=true')  // & often unescaped in URLS\n   * # '/foo?bar=baz&copy=true'\n   * $ unescapeEntities('pi=&pi;&#x3c0;, Pi=&Pi;\\u03A0') // FIXME: known failure\n   * # 'pi=\\u03C0\\u03c0, Pi=\\u03A0\\u03A0'\n   * }\n   *\n   * @param {string} s a chunk of HTML CDATA.  It must not start or end inside\n   *     an HTML entity.\n   */\n  function unescapeEntities(s) {\n    return s.replace(ENTITY_RE_1, decodeOneEntity);\n  }\n\n  var ampRe = /&/g;\n  var looseAmpRe = /&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;\n  var ltRe = /[<]/g;\n  var gtRe = />/g;\n  var quotRe = /\\\"/g;\n\n  /**\n   * Escapes HTML special characters in attribute values.\n   *\n   * {\\@updoc\n   * $ escapeAttrib('')\n   * # ''\n   * $ escapeAttrib('\"<<&==&>>\"')  // Do not just escape the first occurrence.\n   * # '&#34;&lt;&lt;&amp;&#61;&#61;&amp;&gt;&gt;&#34;'\n   * $ escapeAttrib('Hello <World>!')\n   * # 'Hello &lt;World&gt;!'\n   * }\n   */\n  function escapeAttrib(s) {\n    return ('' + s).replace(ampRe, '&amp;').replace(ltRe, '&lt;')\n        .replace(gtRe, '&gt;').replace(quotRe, '&#34;');\n  }\n\n  /**\n   * Escape entities in RCDATA that can be escaped without changing the meaning.\n   * {\\@updoc\n   * $ normalizeRCData('1 < 2 &&amp; 3 > 4 &amp;& 5 &lt; 7&8')\n   * # '1 &lt; 2 &amp;&amp; 3 &gt; 4 &amp;&amp; 5 &lt; 7&amp;8'\n   * }\n   */\n  function normalizeRCData(rcdata) {\n    return rcdata\n        .replace(looseAmpRe, '&amp;$1')\n        .replace(ltRe, '&lt;')\n        .replace(gtRe, '&gt;');\n  }\n\n  // TODO(felix8a): validate sanitizer regexs against the HTML5 grammar at\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html\n\n  // We initially split input so that potentially meaningful characters\n  // like '<' and '>' are separate tokens, using a fast dumb process that\n  // ignores quoting.  Then we walk that token stream, and when we see a\n  // '<' that's the start of a tag, we use ATTR_RE to extract tag\n  // attributes from the next token.  That token will never have a '>'\n  // character.  However, it might have an unbalanced quote character, and\n  // when we see that, we combine additional tokens to balance the quote.\n\n  var ATTR_RE = new RegExp(\n    '^\\\\s*' +\n    '([-.:\\\\w]+)' +             // 1 = Attribute name\n    '(?:' + (\n      '\\\\s*(=)\\\\s*' +           // 2 = Is there a value?\n      '(' + (                   // 3 = Attribute value\n        // TODO(felix8a): maybe use backref to match quotes\n        '(\\\")[^\\\"]*(\\\"|$)' +    // 4, 5 = Double-quoted string\n        '|' +\n        '(\\')[^\\']*(\\'|$)' +    // 6, 7 = Single-quoted string\n        '|' +\n        // Positive lookahead to prevent interpretation of\n        // <foo a= b=c> as <foo a='b=c'>\n        // TODO(felix8a): might be able to drop this case\n        '(?=[a-z][-\\\\w]*\\\\s*=)' +\n        '|' +\n        // Unquoted value that isn't an attribute name\n        // (since we didn't match the positive lookahead above)\n        '[^\\\"\\'\\\\s]*' ) +\n      ')' ) +\n    ')?',\n    'i');\n\n  // false on IE<=8, true on most other browsers\n  var splitWillCapture = ('a,b'.split(/(,)/).length === 3);\n\n  // bitmask for tags with special parsing, like <script> and <textarea>\n  var EFLAGS_TEXT = html4.eflags['CDATA'] | html4.eflags['RCDATA'];\n\n  /**\n   * Given a SAX-like event handler, produce a function that feeds those\n   * events and a parameter to the event handler.\n   *\n   * The event handler has the form:{@code\n   * {\n   *   // Name is an upper-case HTML tag name.  Attribs is an array of\n   *   // alternating upper-case attribute names, and attribute values.  The\n   *   // attribs array is reused by the parser.  Param is the value passed to\n   *   // the saxParser.\n   *   startTag: function (name, attribs, param) { ... },\n   *   endTag:   function (name, param) { ... },\n   *   pcdata:   function (text, param) { ... },\n   *   rcdata:   function (text, param) { ... },\n   *   cdata:    function (text, param) { ... },\n   *   startDoc: function (param) { ... },\n   *   endDoc:   function (param) { ... }\n   * }}\n   *\n   * @param {Object} handler a record containing event handlers.\n   * @return {function(string, Object)} A function that takes a chunk of HTML\n   *     and a parameter.  The parameter is passed on to the handler methods.\n   */\n  function makeSaxParser(handler) {\n    // Accept quoted or unquoted keys (Closure compat)\n    var hcopy = {\n      cdata: handler.cdata || handler['cdata'],\n      comment: handler.comment || handler['comment'],\n      endDoc: handler.endDoc || handler['endDoc'],\n      endTag: handler.endTag || handler['endTag'],\n      pcdata: handler.pcdata || handler['pcdata'],\n      rcdata: handler.rcdata || handler['rcdata'],\n      startDoc: handler.startDoc || handler['startDoc'],\n      startTag: handler.startTag || handler['startTag']\n    };\n    return function(htmlText, param) {\n      return parse(htmlText, hcopy, param);\n    };\n  }\n\n  // Parsing strategy is to split input into parts that might be lexically\n  // meaningful (every \">\" becomes a separate part), and then recombine\n  // parts if we discover they're in a different context.\n\n  // TODO(felix8a): Significant performance regressions from -legacy,\n  // tested on\n  //    Chrome 18.0\n  //    Firefox 11.0\n  //    IE 6, 7, 8, 9\n  //    Opera 11.61\n  //    Safari 5.1.3\n  // Many of these are unusual patterns that are linearly slower and still\n  // pretty fast (eg 1ms to 5ms), so not necessarily worth fixing.\n\n  // TODO(felix8a): \"<script> && && && ... <\\/script>\" is slower on all\n  // browsers.  The hotspot is htmlSplit.\n\n  // TODO(felix8a): \"<p title='>>>>...'><\\/p>\" is slower on all browsers.\n  // This is partly htmlSplit, but the hotspot is parseTagAndAttrs.\n\n  // TODO(felix8a): \"<a><\\/a><a><\\/a>...\" is slower on IE9.\n  // \"<a>1<\\/a><a>1<\\/a>...\" is faster, \"<a><\\/a>2<a><\\/a>2...\" is faster.\n\n  // TODO(felix8a): \"<p<p<p...\" is slower on IE[6-8]\n\n  var continuationMarker = {};\n  function parse(htmlText, handler, param) {\n    var m, p, tagName;\n    var parts = htmlSplit(htmlText);\n    var state = {\n      noMoreGT: false,\n      noMoreEndComments: false\n    };\n    parseCPS(handler, parts, 0, state, param);\n  }\n\n  function continuationMaker(h, parts, initial, state, param) {\n    return function () {\n      parseCPS(h, parts, initial, state, param);\n    };\n  }\n\n  function parseCPS(h, parts, initial, state, param) {\n    try {\n      if (h.startDoc && initial == 0) { h.startDoc(param); }\n      var m, p, tagName;\n      for (var pos = initial, end = parts.length; pos < end;) {\n        var current = parts[pos++];\n        var next = parts[pos];\n        switch (current) {\n        case '&':\n          if (ENTITY_RE_2.test(next)) {\n            if (h.pcdata) {\n              h.pcdata('&' + next, param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n            pos++;\n          } else {\n            if (h.pcdata) { h.pcdata(\"&amp;\", param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\/':\n          if ((m = /^([-\\w:]+)[^\\'\\\"]*/.exec(next))) {\n            if (m[0].length === next.length && parts[pos + 1] === '>') {\n              // fast case, no attribute parsing needed\n              pos += 2;\n              tagName = m[1].toLowerCase();\n              if (h.endTag) {\n                h.endTag(tagName, param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n            } else {\n              // slow case, need to parse attributes\n              // TODO(felix8a): do we really care about misparsing this?\n              pos = parseEndTag(\n                parts, pos, h, param, continuationMarker, state);\n            }\n          } else {\n            if (h.pcdata) {\n              h.pcdata('&lt;/', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<':\n          if (m = /^([-\\w:]+)\\s*\\/?/.exec(next)) {\n            if (m[0].length === next.length && parts[pos + 1] === '>') {\n              // fast case, no attribute parsing needed\n              pos += 2;\n              tagName = m[1].toLowerCase();\n              if (h.startTag) {\n                h.startTag(tagName, [], param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n              // tags like <script> and <textarea> have special parsing\n              var eflags = html4.ELEMENTS[tagName];\n              if (eflags & EFLAGS_TEXT) {\n                var tag = { name: tagName, next: pos, eflags: eflags };\n                pos = parseText(\n                  parts, tag, h, param, continuationMarker, state);\n              }\n            } else {\n              // slow case, need to parse attributes\n              pos = parseStartTag(\n                parts, pos, h, param, continuationMarker, state);\n            }\n          } else {\n            if (h.pcdata) {\n              h.pcdata('&lt;', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\!--':\n          // The pathological case is n copies of '<\\!--' without '-->', and\n          // repeated failure to find '-->' is quadratic.  We avoid that by\n          // remembering when search for '-->' fails.\n          if (!state.noMoreEndComments) {\n            // A comment <\\!--x--> is split into three tokens:\n            //   '<\\!--', 'x--', '>'\n            // We want to find the next '>' token that has a preceding '--'.\n            // pos is at the 'x--'.\n            for (p = pos + 1; p < end; p++) {\n              if (parts[p] === '>' && /--$/.test(parts[p - 1])) { break; }\n            }\n            if (p < end) {\n              if (h.comment) {\n                var comment = parts.slice(pos, p).join('');\n                h.comment(\n                  comment.substr(0, comment.length - 2), param,\n                  continuationMarker,\n                  continuationMaker(h, parts, p + 1, state, param));\n              }\n              pos = p + 1;\n            } else {\n              state.noMoreEndComments = true;\n            }\n          }\n          if (state.noMoreEndComments) {\n            if (h.pcdata) {\n              h.pcdata('&lt;!--', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\!':\n          if (!/^\\w/.test(next)) {\n            if (h.pcdata) {\n              h.pcdata('&lt;!', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          } else {\n            // similar to noMoreEndComment logic\n            if (!state.noMoreGT) {\n              for (p = pos + 1; p < end; p++) {\n                if (parts[p] === '>') { break; }\n              }\n              if (p < end) {\n                pos = p + 1;\n              } else {\n                state.noMoreGT = true;\n              }\n            }\n            if (state.noMoreGT) {\n              if (h.pcdata) {\n                h.pcdata('&lt;!', param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n            }\n          }\n          break;\n        case '<?':\n          // similar to noMoreEndComment logic\n          if (!state.noMoreGT) {\n            for (p = pos + 1; p < end; p++) {\n              if (parts[p] === '>') { break; }\n            }\n            if (p < end) {\n              pos = p + 1;\n            } else {\n              state.noMoreGT = true;\n            }\n          }\n          if (state.noMoreGT) {\n            if (h.pcdata) {\n              h.pcdata('&lt;?', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '>':\n          if (h.pcdata) {\n            h.pcdata(\"&gt;\", param, continuationMarker,\n              continuationMaker(h, parts, pos, state, param));\n          }\n          break;\n        case '':\n          break;\n        default:\n          if (h.pcdata) {\n            h.pcdata(current, param, continuationMarker,\n              continuationMaker(h, parts, pos, state, param));\n          }\n          break;\n        }\n      }\n      if (h.endDoc) { h.endDoc(param); }\n    } catch (e) {\n      if (e !== continuationMarker) { throw e; }\n    }\n  }\n\n  // Split str into parts for the html parser.\n  function htmlSplit(str) {\n    // can't hoist this out of the function because of the re.exec loop.\n    var re = /(<\\/|<\\!--|<[!?]|[&<>])/g;\n    str += '';\n    if (splitWillCapture) {\n      return str.split(re);\n    } else {\n      var parts = [];\n      var lastPos = 0;\n      var m;\n      while ((m = re.exec(str)) !== null) {\n        parts.push(str.substring(lastPos, m.index));\n        parts.push(m[0]);\n        lastPos = m.index + m[0].length;\n      }\n      parts.push(str.substring(lastPos));\n      return parts;\n    }\n  }\n\n  function parseEndTag(parts, pos, h, param, continuationMarker, state) {\n    var tag = parseTagAndAttrs(parts, pos);\n    // drop unclosed tags\n    if (!tag) { return parts.length; }\n    if (h.endTag) {\n      h.endTag(tag.name, param, continuationMarker,\n        continuationMaker(h, parts, pos, state, param));\n    }\n    return tag.next;\n  }\n\n  function parseStartTag(parts, pos, h, param, continuationMarker, state) {\n    var tag = parseTagAndAttrs(parts, pos);\n    // drop unclosed tags\n    if (!tag) { return parts.length; }\n    if (h.startTag) {\n      h.startTag(tag.name, tag.attrs, param, continuationMarker,\n        continuationMaker(h, parts, tag.next, state, param));\n    }\n    // tags like <script> and <textarea> have special parsing\n    if (tag.eflags & EFLAGS_TEXT) {\n      return parseText(parts, tag, h, param, continuationMarker, state);\n    } else {\n      return tag.next;\n    }\n  }\n\n  var endTagRe = {};\n\n  // Tags like <script> and <textarea> are flagged as CDATA or RCDATA,\n  // which means everything is text until we see the correct closing tag.\n  function parseText(parts, tag, h, param, continuationMarker, state) {\n    var end = parts.length;\n    if (!endTagRe.hasOwnProperty(tag.name)) {\n      endTagRe[tag.name] = new RegExp('^' + tag.name + '(?:[\\\\s\\\\/]|$)', 'i');\n    }\n    var re = endTagRe[tag.name];\n    var first = tag.next;\n    var p = tag.next + 1;\n    for (; p < end; p++) {\n      if (parts[p - 1] === '<\\/' && re.test(parts[p])) { break; }\n    }\n    if (p < end) { p -= 1; }\n    var buf = parts.slice(first, p).join('');\n    if (tag.eflags & html4.eflags['CDATA']) {\n      if (h.cdata) {\n        h.cdata(buf, param, continuationMarker,\n          continuationMaker(h, parts, p, state, param));\n      }\n    } else if (tag.eflags & html4.eflags['RCDATA']) {\n      if (h.rcdata) {\n        h.rcdata(normalizeRCData(buf), param, continuationMarker,\n          continuationMaker(h, parts, p, state, param));\n      }\n    } else {\n      throw new Error('bug');\n    }\n    return p;\n  }\n\n  // at this point, parts[pos-1] is either \"<\" or \"<\\/\".\n  function parseTagAndAttrs(parts, pos) {\n    var m = /^([-\\w:]+)/.exec(parts[pos]);\n    var tag = {};\n    tag.name = m[1].toLowerCase();\n    tag.eflags = html4.ELEMENTS[tag.name];\n    var buf = parts[pos].substr(m[0].length);\n    // Find the next '>'.  We optimistically assume this '>' is not in a\n    // quoted context, and further down we fix things up if it turns out to\n    // be quoted.\n    var p = pos + 1;\n    var end = parts.length;\n    for (; p < end; p++) {\n      if (parts[p] === '>') { break; }\n      buf += parts[p];\n    }\n    if (end <= p) { return void 0; }\n    var attrs = [];\n    while (buf !== '') {\n      m = ATTR_RE.exec(buf);\n      if (!m) {\n        // No attribute found: skip garbage\n        buf = buf.replace(/^[\\s\\S][^a-z\\s]*/, '');\n\n      } else if ((m[4] && !m[5]) || (m[6] && !m[7])) {\n        // Unterminated quote: slurp to the next unquoted '>'\n        var quote = m[4] || m[6];\n        var sawQuote = false;\n        var abuf = [buf, parts[p++]];\n        for (; p < end; p++) {\n          if (sawQuote) {\n            if (parts[p] === '>') { break; }\n          } else if (0 <= parts[p].indexOf(quote)) {\n            sawQuote = true;\n          }\n          abuf.push(parts[p]);\n        }\n        // Slurp failed: lose the garbage\n        if (end <= p) { break; }\n        // Otherwise retry attribute parsing\n        buf = abuf.join('');\n        continue;\n\n      } else {\n        // We have an attribute\n        var aName = m[1].toLowerCase();\n        var aValue = m[2] ? decodeValue(m[3]) : '';\n        attrs.push(aName, aValue);\n        buf = buf.substr(m[0].length);\n      }\n    }\n    tag.attrs = attrs;\n    tag.next = p + 1;\n    return tag;\n  }\n\n  function decodeValue(v) {\n    var q = v.charCodeAt(0);\n    if (q === 0x22 || q === 0x27) { // \" or '\n      v = v.substr(1, v.length - 2);\n    }\n    return unescapeEntities(stripNULs(v));\n  }\n\n  /**\n   * Returns a function that strips unsafe tags and attributes from html.\n   * @param {defs.TagPolicy} tagPolicy\n   *     A function that takes (tagName, attribs[]), where tagName is a key in\n   *     html4.ELEMENTS and attribs is an array of alternating attribute names\n   *     and values.  It should return a record (as follows), or null to delete\n   *     the element.  It's okay for tagPolicy to modify the attribs array,\n   *     but the same array is reused, so it should not be held between calls.\n   *     Record keys:\n   *        attribs: (required) Sanitized attributes array.\n   *        tagName: Replacement tag name.\n   * @return {function(string, Array)} A function that sanitizes a string of\n   *     HTML and appends result strings to the second argument, an array.\n   */\n  function makeHtmlSanitizer(tagPolicy) {\n    var stack;\n    var ignoring;\n    var emit = function (text, out) {\n      if (!ignoring) { out.push(text); }\n    };\n    return makeSaxParser({\n      'startDoc': function(_) {\n        stack = [];\n        ignoring = false;\n      },\n      'startTag': function(tagNameOrig, attribs, out) {\n        if (ignoring) { return; }\n        if (!html4.ELEMENTS.hasOwnProperty(tagNameOrig)) { return; }\n        var eflagsOrig = html4.ELEMENTS[tagNameOrig];\n        if (eflagsOrig & html4.eflags['FOLDABLE']) {\n          return;\n        }\n\n        var decision = tagPolicy(tagNameOrig, attribs);\n        if (!decision) {\n          ignoring = !(eflagsOrig & html4.eflags['EMPTY']);\n          return;\n        } else if (typeof decision !== 'object') {\n          throw new Error('tagPolicy did not return object (old API?)');\n        }\n        if ('attribs' in decision) {\n          attribs = decision['attribs'];\n        } else {\n          throw new Error('tagPolicy gave no attribs');\n        }\n        var eflagsRep;\n        var tagNameRep;\n        if ('tagName' in decision) {\n          tagNameRep = decision['tagName'];\n          eflagsRep = html4.ELEMENTS[tagNameRep];\n        } else {\n          tagNameRep = tagNameOrig;\n          eflagsRep = eflagsOrig;\n        }\n        // TODO(mikesamuel): relying on tagPolicy not to insert unsafe\n        // attribute names.\n\n        // If this is an optional-end-tag element and either this element or its\n        // previous like sibling was rewritten, then insert a close tag to\n        // preserve structure.\n        if (eflagsOrig & html4.eflags['OPTIONAL_ENDTAG']) {\n          var onStack = stack[stack.length - 1];\n          if (onStack && onStack.orig === tagNameOrig &&\n              (onStack.rep !== tagNameRep || tagNameOrig !== tagNameRep)) {\n                out.push('<\\/', onStack.rep, '>');\n          }\n        }\n\n        if (!(eflagsOrig & html4.eflags['EMPTY'])) {\n          stack.push({orig: tagNameOrig, rep: tagNameRep});\n        }\n\n        out.push('<', tagNameRep);\n        for (var i = 0, n = attribs.length; i < n; i += 2) {\n          var attribName = attribs[i],\n              value = attribs[i + 1];\n          if (value !== null && value !== void 0) {\n            out.push(' ', attribName, '=\"', escapeAttrib(value), '\"');\n          }\n        }\n        out.push('>');\n\n        if ((eflagsOrig & html4.eflags['EMPTY'])\n            && !(eflagsRep & html4.eflags['EMPTY'])) {\n          // replacement is non-empty, synthesize end tag\n          out.push('<\\/', tagNameRep, '>');\n        }\n      },\n      'endTag': function(tagName, out) {\n        if (ignoring) {\n          ignoring = false;\n          return;\n        }\n        if (!html4.ELEMENTS.hasOwnProperty(tagName)) { return; }\n        var eflags = html4.ELEMENTS[tagName];\n        if (!(eflags & (html4.eflags['EMPTY'] | html4.eflags['FOLDABLE']))) {\n          var index;\n          if (eflags & html4.eflags['OPTIONAL_ENDTAG']) {\n            for (index = stack.length; --index >= 0;) {\n              var stackElOrigTag = stack[index].orig;\n              if (stackElOrigTag === tagName) { break; }\n              if (!(html4.ELEMENTS[stackElOrigTag] &\n                    html4.eflags['OPTIONAL_ENDTAG'])) {\n                // Don't pop non optional end tags looking for a match.\n                return;\n              }\n            }\n          } else {\n            for (index = stack.length; --index >= 0;) {\n              if (stack[index].orig === tagName) { break; }\n            }\n          }\n          if (index < 0) { return; }  // Not opened.\n          for (var i = stack.length; --i > index;) {\n            var stackElRepTag = stack[i].rep;\n            if (!(html4.ELEMENTS[stackElRepTag] &\n                  html4.eflags['OPTIONAL_ENDTAG'])) {\n              out.push('<\\/', stackElRepTag, '>');\n            }\n          }\n          if (index < stack.length) {\n            tagName = stack[index].rep;\n          }\n          stack.length = index;\n          out.push('<\\/', tagName, '>');\n        }\n      },\n      'pcdata': emit,\n      'rcdata': emit,\n      'cdata': emit,\n      'endDoc': function(out) {\n        for (; stack.length; stack.length--) {\n          out.push('<\\/', stack[stack.length - 1].rep, '>');\n        }\n      }\n    });\n  }\n\n  var ALLOWED_URI_SCHEMES = /^(?:https?|geo|mailto|sms|tel)$/i;\n\n  function safeUri(uri, effect, ltype, hints, naiveUriRewriter) {\n    if (!naiveUriRewriter) { return null; }\n    try {\n      var parsed = URI.parse('' + uri);\n      if (parsed) {\n        if (!parsed.hasScheme() ||\n            ALLOWED_URI_SCHEMES.test(parsed.getScheme())) {\n          var safe = naiveUriRewriter(parsed, effect, ltype, hints);\n          return safe ? safe.toString() : null;\n        }\n      }\n    } catch (e) {\n      return null;\n    }\n    return null;\n  }\n\n  function log(logger, tagName, attribName, oldValue, newValue) {\n    if (!attribName) {\n      logger(tagName + \" removed\", {\n        change: \"removed\",\n        tagName: tagName\n      });\n    }\n    if (oldValue !== newValue) {\n      var changed = \"changed\";\n      if (oldValue && !newValue) {\n        changed = \"removed\";\n      } else if (!oldValue && newValue)  {\n        changed = \"added\";\n      }\n      logger(tagName + \".\" + attribName + \" \" + changed, {\n        change: changed,\n        tagName: tagName,\n        attribName: attribName,\n        oldValue: oldValue,\n        newValue: newValue\n      });\n    }\n  }\n\n  function lookupAttribute(map, tagName, attribName) {\n    var attribKey;\n    attribKey = tagName + '::' + attribName;\n    if (map.hasOwnProperty(attribKey)) {\n      return map[attribKey];\n    }\n    attribKey = '*::' + attribName;\n    if (map.hasOwnProperty(attribKey)) {\n      return map[attribKey];\n    }\n    return void 0;\n  }\n  function getAttributeType(tagName, attribName) {\n    return lookupAttribute(html4.ATTRIBS, tagName, attribName);\n  }\n  function getLoaderType(tagName, attribName) {\n    return lookupAttribute(html4.LOADERTYPES, tagName, attribName);\n  }\n  function getUriEffect(tagName, attribName) {\n    return lookupAttribute(html4.URIEFFECTS, tagName, attribName);\n  }\n\n  /**\n   * Sanitizes attributes on an HTML tag.\n   * @param {string} tagName An HTML tag name in lowercase.\n   * @param {Array.<?string>} attribs An array of alternating names and values.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes; it can return a new string value, or null to\n   *     delete the attribute.  If unspecified, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes; it can return a new string value, or null to delete\n   *     the attribute.  If unspecified, these attributes are kept unchanged.\n   * @return {Array.<?string>} The sanitized attributes as a list of alternating\n   *     names and values, where a null value means to omit the attribute.\n   */\n  function sanitizeAttribs(tagName, attribs,\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    // TODO(felix8a): it's obnoxious that domado duplicates much of this\n    // TODO(felix8a): maybe consistently enforce constraints like target=\n    for (var i = 0; i < attribs.length; i += 2) {\n      var attribName = attribs[i];\n      var value = attribs[i + 1];\n      var oldValue = value;\n      var atype = null, attribKey;\n      if ((attribKey = tagName + '::' + attribName,\n           html4.ATTRIBS.hasOwnProperty(attribKey)) ||\n          (attribKey = '*::' + attribName,\n           html4.ATTRIBS.hasOwnProperty(attribKey))) {\n        atype = html4.ATTRIBS[attribKey];\n      }\n      if (atype !== null) {\n        switch (atype) {\n          case html4.atype['NONE']: break;\n          case html4.atype['SCRIPT']:\n            value = null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['STYLE']:\n            if ('undefined' === typeof parseCssDeclarations) {\n              value = null;\n              if (opt_logger) {\n                log(opt_logger, tagName, attribName, oldValue, value);\n        }\n              break;\n            }\n            var sanitizedDeclarations = [];\n            parseCssDeclarations(\n                value,\n                {\n                  'declaration': function (property, tokens) {\n                    var normProp = property.toLowerCase();\n                    sanitizeCssProperty(\n                        normProp, tokens,\n                        opt_naiveUriRewriter\n                        ? function (url) {\n                            return safeUri(\n                                url, html4.ueffects.SAME_DOCUMENT,\n                                html4.ltypes.SANDBOXED,\n                                {\n                                  \"TYPE\": \"CSS\",\n                                  \"CSS_PROP\": normProp\n                                }, opt_naiveUriRewriter);\n                          }\n                        : null);\n                    if (tokens.length) {\n                      sanitizedDeclarations.push(\n                          normProp + ': ' + tokens.join(' '));\n                    }\n                  }\n                });\n            value = sanitizedDeclarations.length > 0 ?\n              sanitizedDeclarations.join(' ; ') : null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['ID']:\n          case html4.atype['IDREF']:\n          case html4.atype['IDREFS']:\n          case html4.atype['GLOBAL_NAME']:\n          case html4.atype['LOCAL_NAME']:\n          case html4.atype['CLASSES']:\n            value = opt_nmTokenPolicy ? opt_nmTokenPolicy(value) : value;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['URI']:\n            value = safeUri(value,\n              getUriEffect(tagName, attribName),\n              getLoaderType(tagName, attribName),\n              {\n                \"TYPE\": \"MARKUP\",\n                \"XML_ATTR\": attribName,\n                \"XML_TAG\": tagName\n              }, opt_naiveUriRewriter);\n              if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['URI_FRAGMENT']:\n            if (value && '#' === value.charAt(0)) {\n              value = value.substring(1);  // remove the leading '#'\n              value = opt_nmTokenPolicy ? opt_nmTokenPolicy(value) : value;\n              if (value !== null && value !== void 0) {\n                value = '#' + value;  // restore the leading '#'\n              }\n            } else {\n              value = null;\n            }\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          default:\n            value = null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n        }\n      } else {\n        value = null;\n        if (opt_logger) {\n          log(opt_logger, tagName, attribName, oldValue, value);\n        }\n      }\n      attribs[i + 1] = value;\n    }\n    return attribs;\n  }\n\n  /**\n   * Creates a tag policy that omits all tags marked UNSAFE in html4-defs.js\n   * and applies the default attribute sanitizer with the supplied policy for\n   * URI attributes and NMTOKEN attributes.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes.  If not given, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes.  If not given, such attributes are left unchanged.\n   * @return {defs.TagPolicy} A tagPolicy suitable for\n   *     passing to html.sanitize.\n   */\n  function makeTagPolicy(\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    return function(tagName, attribs) {\n      if (!(html4.ELEMENTS[tagName] & html4.eflags['UNSAFE'])) {\n        return {\n          'attribs': sanitizeAttribs(tagName, attribs,\n            opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger)\n        };\n      } else {\n        if (opt_logger) {\n          log(opt_logger, tagName, undefined, undefined, undefined);\n        }\n      }\n    };\n  }\n\n  /**\n   * Sanitizes HTML tags and attributes according to a given policy.\n   * @param {string} inputHtml The HTML to sanitize.\n   * @param {function(string, Array.<?string>)} tagPolicy A function that\n   *     decides which tags to accept and sanitizes their attributes (see\n   *     makeHtmlSanitizer above for details).\n   * @return {string} The sanitized HTML.\n   */\n  function sanitizeWithPolicy(inputHtml, tagPolicy) {\n    var outputArray = [];\n    makeHtmlSanitizer(tagPolicy)(inputHtml, outputArray);\n    return outputArray.join('');\n  }\n\n  /**\n   * Strips unsafe tags and attributes from HTML.\n   * @param {string} inputHtml The HTML to sanitize.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes.  If not given, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes.  If not given, such attributes are left unchanged.\n   */\n  function sanitize(inputHtml,\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    var tagPolicy = makeTagPolicy(\n      opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger);\n    return sanitizeWithPolicy(inputHtml, tagPolicy);\n  }\n\n  // Export both quoted and unquoted names for Closure linkage.\n  var html = {};\n  html.escapeAttrib = html['escapeAttrib'] = escapeAttrib;\n  html.makeHtmlSanitizer = html['makeHtmlSanitizer'] = makeHtmlSanitizer;\n  html.makeSaxParser = html['makeSaxParser'] = makeSaxParser;\n  html.makeTagPolicy = html['makeTagPolicy'] = makeTagPolicy;\n  html.normalizeRCData = html['normalizeRCData'] = normalizeRCData;\n  html.sanitize = html['sanitize'] = sanitize;\n  html.sanitizeAttribs = html['sanitizeAttribs'] = sanitizeAttribs;\n  html.sanitizeWithPolicy = html['sanitizeWithPolicy'] = sanitizeWithPolicy;\n  html.unescapeEntities = html['unescapeEntities'] = unescapeEntities;\n  return html;\n})(html4);\n\nvar html_sanitize = html['sanitize'];\n\nexport {\n  html,\n  html_sanitize\n};\n"]}